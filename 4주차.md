# 4주차

## 4-1. 배포시 secret 파일 관리 방법

**목표**

* 절대 노출되어선 안되는 secret 파일들을 관리 하는 방법
  * DB접속정보, AWS Key 등
* Tool
  * BlackBox
  * Vault
  * CredStash

**관리 방법**

* Git에 암호화하여 올리고, 사용시에 복호화
  * BlackBox, git-secret
* 배포할 환경 변수에 값을 저장
  * 시스템 환경변수, AMI
* 암호화 되어 있는 값을 서버에 올려두고 필요할 때마다 내려받는다
  * Vaulit, CredStash

### BlackBox

* GPG로 암호화
* GPG를 더 쉽게 이용할 수 있게 만든 Shell Script

실습


### Credstash

* 매우 단순하고 간단
* AWS KMS, AWS DDB를 이용함
* KMS를 이용하여 key를 받아오고, key value들이 저장되어는 DDB에서 암호화된 값을 가져온 뒤에 복호화
* AWS를 사용해야함
* 사용절차
  * AWS 인증을 통해 암호화 key를 가져옴
  * 암호화 key를 이용하여 DynamoDB에 등록
  * DynamoDB에서 암호화된 값을 가져온뒤 복호화하여 사용


### Vault

* 요즘 많은 인기를 얻고 있는 [HashiCorp](https://www.hashicorp.com/) 제품
  * 인프라에서 사용되는 툴들을 만듬
* 단순하게 key value 방식으로 암호화를 하는 기능이 아닌 **secret**들을 관리할 수 있는 다양한 기능들 제공
* 자주 사용되는 유스케이스를 기능으로 제공
  * 일반적인 값을 암호화하여 저장
  * 시스템들을 위한 임시키 발급
  * key에 만료시간을 주고 갱신할수도 있음
  * 암/복호화
  * key 제거
  * API와 CLI를 이용하여 처리 가능
* 오버엔지니어링이 아닌지 고민후 도입

## 4-2. 자동화된 서버 관리

* 웹 서버에 대한 모든 것을 자동으로, 웹 콘솔로 관리할수 있게 해주는 PaaS
* 다음 항목을 모두 커버
  * 인스턴스 사양
  * 로드 밸런싱
  * 오토 스케일링
  * 로그 조회
  * 상태 분석
  * 모니터링
  * 알림
  * 이벤트 로그
  * 도메인
  * 업데이트
* 로그 내역이 필요한 경우 **모두 웹 콘솔에서 확인 가능**
* 크게 2가지 환경 유지
  * 웹 서비스 환경
  * 비동기로 오래걸리는 작업을 수행할 작업자 환경
* 작업자 환경은 AWS SQS를 이용하여 작업을 전달하고, 그 결과를 받을 수 있는 환경이며 Beanstalk에서는 해당 작업들을 처리하는 서버를 관리
* 단점
  * 오토스케일링의 조건을 CPU와 메모리 사용량 모두로 하고 싶어도 **한번에 한가지 조건**밖에 걸지 못한다.
  * 커스터마이징과 튜닝에 한계가 있다.

## 4-3. DevOps/CI/CD

* 배포준비가 끝나고 사람이 수동으로 실행한다면 CD, 자동으로 배포가 진행되면 CD
  * CI가 끝나 정상적으로 말린 Jar를 배포하는 젠킨스 Job 실행을 사람이 직접 실행하면 CD인듯?

### AWS CodePipeline

* AWS내 서비스들과 AWS외 유명한 서비스들간의 조합을 통해 ci/cd pipeline을 지원
* 총 6가지 카테고리 지원
  * Source
  * Build
  * Test
  * Deploy
  * Invoke
  * Approval
* Invoke에서는 lambda를 이용하여 모든것들을 직접 호출할 수 있다.

